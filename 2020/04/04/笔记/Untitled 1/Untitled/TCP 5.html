<h1 id="TCP连接的释放"><a href="#TCP连接的释放" class="headerlink" title="TCP连接的释放"></a>TCP连接的释放</h1><h1 id="四次挥手"><a href="#四次挥手" class="headerlink" title="四次挥手"></a>四次挥手</h1><h2 id="第一次→接收方"><a href="#第一次→接收方" class="headerlink" title="第一次→接收方"></a>第一次→接收方</h2><ul>
<li><code>FIN=1</code>，seq=u，表示需要释放连接</li>
<li>连接结束的第一个等待状态FIN-WAIT-1</li>
</ul>
<h2 id="第二次→发送方"><a href="#第二次→发送方" class="headerlink" title="第二次→发送方"></a>第二次→发送方</h2><ul>
<li>ACK=1,seq=v,ack=u+1释放消息已经收到</li>
<li>发送方进入第二个等待状态 <code>FIN-WAIT-2</code>，此状态发送方仍然可以进行数据的发送</li>
<li>接收方进入了关闭等待的状态CLOSE-WAIT—接收方还可以进行消息的发送接收</li>
</ul>
<h2 id="第三次→发送方"><a href="#第三次→发送方" class="headerlink" title="第三次→发送方"></a>第三次→发送方</h2><ul>
<li>FIN=1，ACK=1，seq=w，ack=u+1</li>
<li>发送方：LAST-ACK　，进入最后确认的状态</li>
</ul>
<h2 id="第四次"><a href="#第四次" class="headerlink" title="第四次"></a>第四次</h2><ul>
<li>ACK=1,seq=u+1,ack=w+1</li>
<li>发送方：<strong><code>等待计时器</code></strong>，关闭</li>
<li>接收方：关闭</li>
</ul>
<h2 id="等待计时器"><a href="#等待计时器" class="headerlink" title="等待计时器"></a>等待计时器</h2><ul>
<li>TIME-WAIT ，等待一段时间，确保没有发生任何问题</li>
</ul>
<p><img src="TCP%205/Untitled.png" alt="TCP%205/Untitled.png"></p>
<ul>
<li>等待计时器的等待时间: 2MSL</li>
<li>MSL Max Segment Lifetime :  最长报文段寿命 ,通常设成 <code>**2分钟**</code></li>
<li>等待计时器期间不会释放此端口</li>
</ul>
<p><img src="TCP%205/Untitled%201.png" alt="TCP%205/Untitled%201.png"></p>
<h3 id="为什么需要等待2MSL"><a href="#为什么需要等待2MSL" class="headerlink" title="为什么需要等待2MSL?"></a>为什么需要等待2MSL?</h3><ul>
<li>最后一个报文没有确认</li>
<li>确保发送方的<code>**ACK**</code>可以到达接收方</li>
<li><strong><code>2MSL时间内没有收到, 则接收方会重发</code></strong></li>
<li>确保当前连接的所有报文都已经过期</li>
</ul>
